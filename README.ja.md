[**English**](README.md) | [**æ—¥æœ¬èª**](README.ja.md)

# RFS: Robot Family System (ãƒ­ãƒœãƒƒãƒˆå®¶æ—ã‚·ã‚¹ãƒ†ãƒ )

RFS (Robot Family System) ã¯ã€å®¶æ—ç™‚æ³•ãŠã‚ˆã³å®¶æ—å¿ƒç†å­¦ã®ãŸã‚ã®ROS2ãƒ™ãƒ¼ã‚¹ã®ç ”ç©¶ãƒ»æ•™è‚²ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚è¤‡æ•°ã®LLMãƒ™ãƒ¼ã‚¹ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ´»ç”¨ã—ã¦è¤‡é›‘ãªå®¶æ—ã®ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€FACES IV å††ç’°ãƒ¢ãƒ‡ãƒ«ä¸Šã§å¿ƒç†çŠ¶æ…‹ã‚’å¯è¦–åŒ–ã—ã€å‹¾é…é™ä¸‹æ³•ï¼ˆGradient Descentï¼‰ã‚’ç”¨ã„ã¦AIä¸»å°ã®æ²»ç™‚ä»‹å…¥ã‚’ææ¡ˆã—ã¾ã™ã€‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ç­‘æ³¢å¤§å­¦ **ç”°ä¸­æ–‡è‹±ç ”ç©¶å®¤** ã®ç ”ç©¶ã®ä¸€éƒ¨ã¨ã—ã¦é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ã€‚å½“ç ”ç©¶å®¤ã§ã¯ã€ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ­ãƒœãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã€ç¤¾ä¼šå¿ƒç†å­¦ã€ãŠã‚ˆã³é«˜åº¦ãªAIã®äº¤å·®ç‚¹ã«ç„¦ç‚¹ã‚’å½“ã¦ã€äººé–“ã®ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°ã¨ç¤¾ä¼šçš„èª¿å’Œã‚’å‘ä¸Šã•ã›ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

ğŸ”— **ç ”ç©¶å®¤ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰**: [ç”°ä¸­æ–‡è‹±ç ”ç©¶å®¤ - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ](https://www.ftl.iit.tsukuba.ac.jp/projects/)

## ğŸŒŸ ä¸»ãªæ©Ÿèƒ½

- **ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: é«˜åº¦ãªLLMã‚’ä½¿ç”¨ã—ã¦ã€å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ãã‚Œãã‚Œã®å€‹æ€§ï¼ˆçˆ¶ã€æ¯ã€å¨˜ã€æ¯å­ï¼‰ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚
- **FACES IV å¯è¦–åŒ–**: å®¶æ—ã®ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ã‚’ã€Œè¦ªå¯†åº¦ï¼ˆCohesionï¼‰ã€ã¨ã€ŒæŸ”è»Ÿæ€§ï¼ˆFlexibilityï¼‰ã€ã®è»¸ä¸Šã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ã€‚
- **ãƒ‡ãƒ¥ã‚¢ãƒ«è»Œè·¡ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**: ã€Œå®Ÿéš›ã®å®¶æ—ã®çŠ¶æ…‹ã€ã¨ã€Œæ²»ç™‚ç›®æ¨™ã€ã®ä¸¡æ–¹ã‚’åŒã˜ãƒ—ãƒ­ãƒƒãƒˆä¸Šã«å¯è¦–åŒ–ã—ã¾ã™ã€‚
- **äºˆæ¸¬çš„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³**: ã€ŒèƒŒæ™¯ã‚·ãƒŠãƒªã‚ªç”Ÿæˆã€ã‚’å®Ÿè£…ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å¿œç­”ã‚’äº‹å‰ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€é…å»¶ã‚’å¤§å¹…ã«å‰Šæ¸›ã—ã¾ã™ã€‚
- **ç‰©ç†è¡¨ç¾**: [toioâ„¢](https://toio.io/) ãƒ­ãƒœãƒƒãƒˆã¨ã®é€£æºã«ã‚ˆã‚Šã€å¯¾äººè·é›¢ã‚’ç‰©ç†çš„ã«è¡¨ç¾ã—ã¾ã™ã€‚
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–éŸ³å£°**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°èªè­˜ï¼ˆSTTï¼‰ã¨ã€éŸ³å£°åˆæˆï¼ˆTTSï¼‰ã«ã‚ˆã‚Šã€äººé–“ã«ã‚ˆã‚‹ä»‹å…¥ãŒå¯èƒ½ã§ã™ã€‚

## ğŸ— ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨å‡¦ç†ãƒ•ãƒ­ãƒ¼

ã‚·ã‚¹ãƒ†ãƒ ã¯ã€**AI Therapist** (`rfs_therapist`) ãŒOlsonã®å††ç’°ãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ã„ã¦å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ã‚’å¥åº·çš„ã§ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸçŠ¶æ…‹ã¸ã¨èª˜å°ã™ã‚‹ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ãƒ«ãƒ¼ãƒ—ãƒ»ã‚µã‚¤ã‚¯ãƒ«ã§å‹•ä½œã—ã¾ã™ã€‚**äººé–“ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰** ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å®¶æ—ã®å¯¾è©±ã«ä»‹å…¥ã—ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![System Architecture](docs/images/architecture.png)

### ãƒãƒ¼ãƒ‰ã”ã¨ã®è©³ç´°ãªå½¹å‰²

| ãƒãƒ¼ãƒ‰ | å½¹å‰² | ä¸»ãªæ©Ÿèƒ½ |
| :--- | :--- | :--- |
| **`rfs_therapist`** | æ²»ç™‚çš„ä»‹å…¥ã®åˆ¶å¾¡ | å‹¾é…é™ä¸‹æ³•ã‚’ç”¨ã„ã¦ã€ãƒãƒ©ãƒ³ã‚¹ãƒ»ã‚¿ã‚¤ãƒ—ã¸ã®é·ç§»ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚ |
| **`rfs_family`** | å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ | LLMã‚’ä½¿ç”¨ã—ã¦å®¶æ—ã®å€‹æ€§ï¼ˆçˆ¶ã€æ¯ãªã©ï¼‰ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚ |
| **`rfs_stt`** | éŸ³å£°å…¥åŠ› | Gemini Liveã‚’ä»‹ã—ãŸäººé–“ä»‹å…¥ã®ãŸã‚ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°èªè­˜ã€‚ |
| **`rfs_tts`** | éŸ³å£°å‡ºåŠ› | å®¶æ—ã®å¯¾è©±ã®ãŸã‚ã®ãƒãƒ«ãƒã‚·ãƒ³ã‚¯åŒæœŸéŸ³å£°åˆæˆã€‚ |
| **`rfs_toio`** | ç‰©ç†ãƒ¬ã‚¤ãƒ¤ãƒ¼ | [toioâ„¢](https://toio.io/) ãƒ­ãƒœãƒƒãƒˆã‚’ä½¿ç”¨ã—ãŸå¯¾äººè·é›¢ã®è¡¨ç¾ã€‚ |
| **`rfs_viewer`** | å¯è¦–åŒ– | å¿ƒç†çš„è»Œè·¡ã‚’ãƒ—ãƒ­ãƒƒãƒˆã™ã‚‹ãŸã‚ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ GUIã€‚ |
| **`rfs_evaluation`** | ãƒãƒƒãƒ”ãƒ³ã‚°ã¨è©•ä¾¡ | ãƒ­ã‚°ã‚’é›†è¨ˆã—ã€FACES IV å††ç’°ãƒ¢ãƒ‡ãƒ«ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ã€‚ |

## ğŸš€ ã¯ã˜ã‚ã«

### å‰ææ¡ä»¶
- **OS**: Ubuntu 24.04 (Noble Numbat)
- **ROS2**: [Jazzy Jalisco](https://docs.ros.org/en/jazzy/Installation.html)
- **Hardware**: [toioâ„¢](https://toio.io/) ã‚³ã‚¢ ã‚­ãƒ¥ãƒ¼ãƒ– (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)ã€‚

### å¿…è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Requirements)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹å‰ã«ã€å¿…è¦ãªã‚·ã‚¹ãƒ†ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ Python ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

**1. ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚**
```bash
sudo apt update && sudo apt install -y python3-tk libportaudio2
```

**2. Python ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**
```bash
pip install openai google-genai numpy sounddevice webrtcvad matplotlib toio-py Pillow
```

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. **ã‚¯ãƒ­ãƒ¼ãƒ³ã¨ãƒ“ãƒ«ãƒ‰**:
   ```bash
   git clone https://github.com/robotaichi/rfs.git
   cd rfs
   colcon build
   source install/setup.bash
   ```

### è¨­å®š (Configuration)

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã™ã‚‹å‰ã«ã€æœ‰åŠ¹ãªAPIã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è¨­å®šã‚’æ°¸ç¶šåŒ–ã™ã‚‹ã«ã¯ã€`~/.bashrc` ã«è¿½è¨˜ã—ã¦ãã ã•ã„ï¼š

```bash
# 1. .bashrc ã‚’é–‹ã
nano ~/.bashrc

# 2. ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ«å°¾ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¦ä¿å­˜
export OPENAI_API_KEY="sk-..."
export GEMINI_API_KEY="AIza..."

# 3. è¨­å®šã‚’åæ˜ 
source ~/.bashrc
```

- [**`OPENAI_API_KEY`**](https://platform.openai.com/api-keys): LLMãƒ™ãƒ¼ã‚¹ã®å¯¾è©±ç”ŸæˆãŠã‚ˆã³å¿ƒç†ãƒãƒƒãƒ”ãƒ³ã‚°ã«ä¸å¯æ¬ ã§ã™ã€‚
- [**`GEMINI_API_KEY`**](https://aistudio.google.com/app/apikey): Gemini Liveãƒ™ãƒ¼ã‚¹ã®éŸ³å£°æ›¸ãèµ·ã“ã—ã«å¿…è¦ã§ã™ã€‚

2. **èµ·å‹•**:
   ```bash
   ros2 launch rfs_bringup rfs_all.launch.py
   ```

## âš™ï¸ è¨­å®š (Settings)

### `config.json` ä»•æ§˜
`src/rfs_config/config/config.json` ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
| :--- | :--- | :--- | :--- |
| **`language`** | String | `"en"` | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è¨€èª: `"en"` (è‹±èª) ã¾ãŸã¯ `"ja"` (æ—¥æœ¬èª)ã€‚ |
| **`theme`** | String | N/A | å®¶æ—ã®ä¼šè©±ã®ãƒã‚¤ãƒ¬ãƒ™ãƒ«ãªãƒˆãƒ”ãƒƒã‚¯ã€‚ |
| **`chat_mode`** | Integer | `0` | `0` (é€šå¸¸), `1` (ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ¢ãƒ¼ãƒ‰ - ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãªã—)ã€‚ |
| **`toio_move`** | Integer | `0` | toioã®ç§»å‹•ã‚’æœ‰åŠ¹åŒ–: `1` (æœ‰åŠ¹), `0` (ç„¡åŠ¹)ã€‚ |
| **`target_user`** | String | `"User"` | å®¶æ—ã¨å¯¾è©±ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã€‚ |
| **`family_config`** | List | `["father", "mother", "daughter"]` | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå®¶æ—ã®å½¹å‰²ã€‚ |
| **`toio_speaker_match`** | List | `[...]` | ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ï¼ˆtoioï¼‰ã¨ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®å¯¾å¿œä»˜ã‘è¨­å®šã€‚ |
| **`learning_rate_scaling`** | Float | `0.25` | æ²»ç™‚çš„èª˜å°ã®åŸºæœ¬æ„Ÿåº¦ã€‚ |
| **`w1`, `w2`, `w3`** | Float | `1.0, 1.0, 0.5` | è¦ªå¯†åº¦ã€æŸ”è»Ÿæ€§ã€ãŠã‚ˆã³ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é‡ã¿ã€‚ |
| **`turns_per_step`** | Integer | `10` | è©•ä¾¡ãƒˆãƒªã‚¬ãƒ¼ã®é »åº¦ (å˜ä½: **ã‚¿ãƒ¼ãƒ³**)ã€‚ |
| **`vad_aggressiveness`** | Integer | `3` | VADï¼ˆéŸ³å£°æ´»å‹•æ¤œçŸ¥ï¼‰ã®æ„Ÿåº¦ (ç¯„å›²: 0-3)ã€‚ |
| **`silence_duration_s`** | Float | `2.0` | ç™ºè©±çµ‚äº†ã¨ã¿ãªã™ç„¡éŸ³æ™‚é–“ (å˜ä½: **ç§’**)ã€‚ |
| **`speech_trigger_frames`** | Integer | `5` | éŒ²éŸ³é–‹å§‹ã«å¿…è¦ãªãƒ•ãƒ¬ãƒ¼ãƒ æ•° (30ms/ãƒ•ãƒ¬ãƒ¼ãƒ )ã€‚ |
| **`vad_debug`** | Boolean | `false` | è¨ºæ–­ç”¨ã®è©³ç´°ãª VAD ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–ã€‚ |
| **`vad_energy_threshold`** | Float | `2000.0` | ç™ºè©±æ¤œçŸ¥ã®ãŸã‚ã®æœ€å° RMS ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¬ãƒ™ãƒ«ã€‚ |
| **`llm_model`** | String | `"gpt-4o"` | å®¶æ—ã®å¯¾è©±ç”Ÿæˆã«ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã€‚ |
| **`llm_temperature`** | Float | `1.0` | å¯¾è©±ã®å‰µé€ æ€§ä¿‚æ•°ã€‚ |
| **`llm_evaluation_model`** | String | `"gpt-4o"` | FACES IV è‡ªå·±è©•ä¾¡ã«ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã€‚ |
| **`llm_evaluation_temperature`** | Float | `0.7` | è©•ä¾¡ã®å®‰å®šæ€§ä¿‚æ•°ã€‚ |
| **`initial_coords`** | Object | `{"x": 8, "y": 8}` | é–‹å§‹åº§æ¨™ (ã‚¹ã‚±ãƒ¼ãƒ«: **0-100 ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«**)ã€‚ |
| **`experiment`** | String | `""` | è©¦è¡Œ/å®Ÿé¨“ãƒ©ãƒ™ãƒ«ç”¨ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¿ã‚°ã€‚ |
| **`terminal_mode`** | String | `"gnome-terminal"` | ãƒãƒ¼ãƒ‰ã®èµ·å‹•ã«ä½¿ç”¨ã™ã‚‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã€‚ |
| **`shutdown_timer_minutes`** | Integer | `0` | è‡ªå‹•ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼ã€‚`0` (ç„¡åŠ¹ - æ°¸ç¶š), `1+` (çµ‚äº†ã¾ã§ã®åˆ†æ•°ã‚’æŒ‡å®š)ã€‚ |

### LLM ã®é¸æŠã¨ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ« (`gpt-4o`)**: å„ªã‚ŒãŸæ¨è«–èƒ½åŠ›ã¨äººé–“ç¤¾ä¼šã®åŠ›å­¦ã«å¯¾ã™ã‚‹æ·±ã„ç†è§£ã‹ã‚‰ã€`gpt-4o` ã‚’æ¨™æº–ã¨ã—ã¦æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã®ç ”ç©¶ã«å¿…è¦ãªè¤‡é›‘ãªå¿ƒç†å­¦çš„å½¹å‰²ã‚’åŠ¹æœçš„ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚
- **æ¸©åº¦ï¼ˆTemperatureï¼‰ è¨­å®š**:
  - **å¯¾è©± (`1.0`)**: å®¶æ—ã®ç›¸äº’ä½œç”¨ã®å‹•çš„ãªæ€§è³ªã‚’åæ˜ ã—ã€è‡ªç„¶ã§å¤šæ§˜ã‹ã¤å‰µé€ çš„ãªä¼šè©±ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ã€ã‚ˆã‚Šé«˜ã„æ¸©åº¦ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  - **è©•ä¾¡ (`0.7`)**: å¿ƒç†çš„è©•ä¾¡ã«ãŠã„ã¦ã€ä¿¡é ¼æ€§ã¨ä¸€è²«æ€§ã‚’ä¿ã¡ã¤ã¤ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã•ã‚ŒãŸãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œä¸»è¦³çš„ãªæ„Ÿè¦šã€ã‚’æ‰ãˆã‚‹ãŸã‚ã«ã€ã‚„ã‚„ä½ã„æ¸©åº¦ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

## ğŸ“Š FACES IV ãƒ¢ãƒ‡ãƒ«ã¨å‹¾é…é™ä¸‹æ³•

ã‚·ã‚¹ãƒ†ãƒ ã¯ã€æ²»ç™‚çš„ä»‹å…¥ã‚’æœ€é©åŒ–å•é¡Œã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚å®¶æ—ã®çŠ¶æ…‹ãŒã€ŒéŠé›¢ï¼ˆDisengagedï¼‰ã€ã¾ãŸã¯ã€Œå¯†ç€ï¼ˆEnmeshedï¼‰ã€ã¨ç‰¹å®šã•ã‚ŒãŸå ´åˆã€**AI Therapist** ã¯ **å‹¾é…é™ä¸‹æ³•ï¼ˆGradient Descentï¼‰** ã‚’ä½¿ç”¨ã—ã¦å¥åº·ãªçŠ¶æ…‹ã¸ã®æœ€é©ãªãƒ‘ã‚¹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

### Olson ã®å††ç’°ãƒ¢ãƒ‡ãƒ« (Circumplex Model)

**Olson ã®å††ç’°ãƒ¢ãƒ‡ãƒ« (Circumplex Model of Marital and Family Systems)** ã¯ã€å®¶æ—ã®ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ã‚’ **ã€Œè¦ªå¯†åº¦ (Cohesion)ã€**ã€**ã€ŒæŸ”è»Ÿæ€§ (Flexibility)ã€**ã€ãŠã‚ˆã³ **ã€Œã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Communication)ã€** ã®3ã¤ã®ä¸»è¦ãªæ¬¡å…ƒã§ç†è§£ã™ã‚‹ãŸã‚ã®æ çµ„ã¿ã§ã™ã€‚

1.  **è¦ªå¯†åº¦ (Cohesion)**: å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼é–“ã®æƒ…ç·’çš„ãªçµã³ã¤ãã‚„ä¸€ä½“æ„Ÿã®å¼·ã•ã‚’æ¸¬å®šã—ã¾ã™ã€‚
2.  **æŸ”è»Ÿæ€§ (Flexibility)**: ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã®è³ªã€å½¹å‰²é–¢ä¿‚ã€ãŠã‚ˆã³ã‚¹ãƒˆãƒ¬ã‚¹ã«å¯¾ã™ã‚‹é©å¿œèƒ½åŠ›ã‚’æ¸¬å®šã—ã¾ã™ã€‚
3.  **ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Communication)**: å®¶æ—ãŒè¦ªå¯†åº¦ã¨æŸ”è»Ÿæ€§ã®ãƒ¬ãƒ™ãƒ«ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ä¿ƒé€²çš„ãªæ¬¡å…ƒã§ã™ã€‚

ã“ã®ãƒ¢ãƒ‡ãƒ«ã§ã¯ã€å®¶æ—ã®çŠ¶æ…‹ã‚’ **ã€Œãƒãƒ©ãƒ³ã‚¹ (Balanced)ã€**ï¼ˆå¥åº·çš„ãƒ»æ©Ÿèƒ½çš„ï¼‰ãªé ˜åŸŸã¨ã€**ã€Œã‚¢ãƒ³ãƒãƒ©ãƒ³ã‚¹ (Unbalanced)ã€**ï¼ˆæ¥µç«¯ãƒ»ä¸å…¨çš„ï¼‰ãªé ˜åŸŸã«åˆ†é¡ã—ã¾ã™ã€‚æœ¬ã‚·ã‚¹ãƒ†ãƒ ã® AI Therapist ã¯ã€ã“ã®ãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ãã€ã‚¢ãƒ³ãƒãƒ©ãƒ³ã‚¹ãªçŠ¶æ…‹ï¼ˆä¾‹ï¼šç¡¬ç›´ã—ãŸéŠé›¢çŠ¶æ…‹ã‚„ã€æ··ä¹±ã—ãŸå¯†ç€çŠ¶æ…‹ï¼‰ã«ã‚ã‚‹æ“¬ä¼¼å®¶æ—ã‚’ **ã€Œãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸä¸­å¿ƒ (Balanced Center)ã€** ã¸ã¨å°ãã¾ã™ã€‚

![Olson's Circumplex Model](docs/images/circumplex_model.png)

### ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å¤‰æ›

æ•°å­¦çš„ãªå‡¦ç†ã‚„ãƒ—ãƒ­ãƒƒãƒˆã®å‰ã«ã€ã‚·ã‚¹ãƒ†ãƒ ã¯è©•ä¾¡ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸ **Raw Scoresï¼ˆç”Ÿå¾—ç‚¹ï¼‰** ã‚’ **Percentile Scoresï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«é †ä½ï¼‰** ã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯ã€å††ç’°ãƒ¢ãƒ‡ãƒ«ä¸Šã¸ã®æ¨™æº–åŒ–ã•ã‚ŒãŸãƒãƒƒãƒ”ãƒ³ã‚°ã«ä¸å¯æ¬ ã§ã‚ã‚Šã€å‹¾é…é™ä¸‹æ³•ãŒæ­£è¦åŒ–ã•ã‚ŒãŸã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ$0$ ã‹ã‚‰ $100$ï¼‰ã§å‹•ä½œã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€æ¨™æº–çš„ãª FACES IV åŸºæº–ã«åŸºã¥ã„ãŸä»¥ä¸‹ã®å¤‰æ›ãƒãƒ£ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

#### 1. ãƒãƒ©ãƒ³ã‚¹å°ºåº¦ãŠã‚ˆã³ã‚¢ãƒ³ãƒãƒ©ãƒ³ã‚¹å°ºåº¦ (è¦ªå¯†åº¦ã¨æŸ”è»Ÿæ€§)

| Raw Score | Balanced Percentile (C/F) | Unbalanced Percentile (D/E/R/C) |
| :--- | :--- | :--- |
| **7** | 16 | 10 |
| **8** | 18 | 12 |
| **9** | 20 | 13 |
| **10** | 22 | 14 |
| **11** | 24 | 15 |
| **12** | 25 | 16 |
| **13** | 26 | 18 |
| **14** | 27 | 20 |
| **15** | 28 | 24 |
| **16** | 30 | 26 |
| **17** | 32 | 30 |
| **18** | 35 | 32 |
| **19** | 36 | 34 |
| **20** | 38 | 36 |
| **21** | 40 | 40 |
| **22** | 45 | 45 |
| **23** | 50 | 50 |
| **24** | 55 | 55 |
| **25** | 58 | 60 |
| **26** | 60 | 64 |
| **27** | 62 | 68 |
| **28** | 65 | 70 |
| **29** | 68 | 75 |
| **30** | 70 | 80 |
| **31** | 75 | 85 |
| **32** | 80 | 90 |
| **33** | 82 | 95 |
| **34** | 84 | 98 |
| **35** | 85 | 99 |

#### 2. å®¶æ—ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³

| Raw Score | Percentile || Raw Score | Percentile |
| :--- | :--- | :--- | :--- | :--- |
| **10-23** | 10 || **37** | 58 |
| **24** | 12 || **38** | 62 |
| **25** | 13 || **39** | 65 |
| **26** | 14 || **40** | 70 |
| **27** | 15 || **41** | 74 |
| **28** | 18 || **42** | 80 |
| **29** | 21 || **43** | 83 |
| **30** | 24 || **44** | 86 |
| **31** | 28 || **45** | 88 |
| **32** | 32 || **46** | 90 |
| **33** | 36 || **47** | 94 |
| **34** | 40 || **48** | 96 |
| **35** | 44 || **49** | 97 |
| **36** | 50 || **50** | 99 |

### æ¯”ç‡ã‚¹ã‚³ã‚¢ (Ratio Scores)

ã‚·ã‚¹ãƒ†ãƒ ã¯ã€å®¶æ—ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“çš„ãªå¥åº·çŠ¶æ…‹ã‚’è©•ä¾¡ã™ã‚‹ãŸã‚ã« **æ¯”ç‡ã‚¹ã‚³ã‚¢** ã‚‚è¨ˆç®—ã—ã¾ã™ã€‚æ¯”ç‡ã‚¹ã‚³ã‚¢ãŒ 1 ã‚ˆã‚Šå¤§ãã„å ´åˆã¯é€šå¸¸ã€å¥åº·çš„ã§ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã€1 æœªæº€ã®å ´åˆã¯ã‚¢ãƒ³ãƒãƒ©ãƒ³ã‚¹ãªï¼ˆä¸å¥åº·ãªï¼‰ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºå”†ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã¯å¤‰æ›ã•ã‚ŒãŸ **ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«é †ä½** ã‚’ä½¿ç”¨ã—ã¦è¨ˆç®—ã•ã‚Œã¾ã™ã€‚

1. **è¦ªå¯†åº¦æ¯”ç‡ (Cohesion Ratio)**
> [!NOTE]
> ```math
> \text{Cohesion Ratio} = \frac{C_{bal}}{(C_{dis} + C_{enm}) / 2}
> ```

2. **æŸ”è»Ÿæ€§æ¯”ç‡ (Flexibility Ratio)**
> [!NOTE]
> ```math
> \text{Flexibility Ratio} = \frac{F_{bal}}{(F_{rig} + F_{cha}) / 2}
> ```

3. **ãƒˆãƒ¼ã‚¿ãƒ«æ¯”ç‡ (Total Ratio)**
> [!NOTE]
> ```math
> \text{Total Ratio} = \frac{\text{Cohesion Ratio} + \text{Flexibility Ratio}}{2}
> ```

### æ•°å­¦çš„åŸºç›¤

AI Therapist ã¯ã€å®¶æ—ã®çŠ¶æ…‹ãƒ™ã‚¯ãƒˆãƒ«ã«å¯¾ã—ã¦å‹¾é…é™ä¸‹æ³•ã‚’è¡Œã„ã€æœ€é©ãªæ²»ç™‚ãƒ‘ã‚¹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

#### 1. çŠ¶æ…‹ãƒ™ã‚¯ãƒˆãƒ« ($x_t$)
ã‚¿ãƒ¼ãƒ³ $t$ ã«ãŠã‘ã‚‹å®¶æ—ã®çŠ¶æ…‹ã¯ã€å¤‰æ›ã•ã‚ŒãŸ **ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«é †ä½** ã‹ã‚‰ãªã‚‹ 7 æ¬¡å…ƒã®ãƒ™ã‚¯ãƒˆãƒ«ã¨ã—ã¦è¡¨ã•ã‚Œã¾ã™ã€‚

> [!NOTE]
> ```math
> x_t = \begin{bmatrix} C_{bal} \\ C_{dis} \\ C_{enm} \\ F_{bal} \\ F_{rig} \\ F_{cha} \\ Comm \end{bmatrix} = [C_{bal}, \dots, Comm]^T
> ```

#### 2. ç›®çš„é–¢æ•° ($J(x_t)$)
ç›®æ¨™ã¯ã€FACES IVæ¯”ç‡ï¼ˆå¥åº·ï¼‰ã¨ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ï¼ˆå®‰å®šæ€§ï¼‰ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ã¨ã‚‹ã‚³ã‚¹ãƒˆé–¢æ•°ã‚’æœ€å°åŒ–ã™ã‚‹ã“ã¨ã§ã™ã€‚

> [!NOTE]
> ```math
> J(x_t) = \omega_1 \frac{U}{2B} - \omega_2 Comm_t + \frac{\omega_3}{2} \left[ (x - 50)^2 + (y - 50)^2 \right]
> ```
ã“ã“ã§:
- $B = C_{bal} + F_{bal}$ (ãƒãƒ©ãƒ³ã‚¹å°ºåº¦ã®å’Œ)
- $U = C_{dis} + C_{enm} + F_{rig} + F_{cha}$ (ã‚¢ãƒ³ãƒãƒ©ãƒ³ã‚¹å°ºåº¦ã®å’Œ)

> [!NOTE]
> ```math
> x = C_{bal} + \frac{C_{enm} - C_{dis}}{2}, \quad y = F_{bal} + \frac{F_{cha} - F_{rig}}{2}
> ```

#### 3. å‹¾é…è¨ˆç®— ($\nabla J(x_t)$)
å‹¾é…ãƒ™ã‚¯ãƒˆãƒ« $\nabla J(x_t)$ ã¯ã€ã‚³ã‚¹ãƒˆé–¢æ•°ãŒæœ€ã‚‚æ€¥æ¿€ã«å¢—åŠ ã™ã‚‹æ–¹å‘ã‚’è¡¨ã—ã¾ã™ã€‚

> [!NOTE]
> ```math
> \nabla J(x_t) = \left[ \frac{\partial J}{\partial C_{bal}}, \dots, \frac{\partial J}{\partial Comm} \right]^T
> ```

å€‹ã€…ã®åå°é–¢æ•°ã¯æ¬¡ã®ã‚ˆã†ã«è¨ˆç®—ã•ã‚Œã¾ã™ï¼ˆæ¯”ç‡é …ã¨ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°é …ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ï¼‰ã€‚

> [!NOTE]
> ```math
> \begin{aligned}
> \frac{\partial J}{\partial C_{bal}} &= - \frac{\omega_1 U}{2B^2} + \omega_3(x - 50) \\
> \frac{\partial J}{\partial F_{bal}} &= - \frac{\omega_1 U}{2B^2} + \omega_3(y - 50) \\
> \frac{\partial J}{\partial C_{enm}} &= \frac{\omega_1}{2B} + \frac{\omega_3}{2}(x - 50) \\
> \frac{\partial J}{\partial C_{dis}} &= \frac{\omega_1}{2B} - \frac{\omega_3}{2}(x - 50) \\
> \frac{\partial J}{\partial F_{cha}} &= \frac{\omega_1}{2B} + \frac{\omega_3}{2}(y - 50) \\
> \frac{\partial J}{\partial F_{rig}} &= \frac{\omega_1}{2B} - \frac{\omega_3}{2}(y - 50) \\
> \frac{\partial J}{\partial Comm} &= - \omega_2
> \end{aligned}
> ```

#### 4. æ›´æ–°ãƒ«ãƒ¼ãƒ«ã¨é©å¿œçš„å­¦ç¿’ç‡
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆçŠ¶æ…‹ã¯åå¾©çš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚

> [!NOTE]
> ```math
> x_{t+1} = x_t - \eta(Comm_t) \cdot \nabla J(x_t)
> ```

ã“ã“ã§ã€é©å¿œçš„å­¦ç¿’ç‡ $\eta (Comm_t)$ ã¯ **ã‚¹ãƒ†ãƒƒãƒ—å¹…** ã‚’è¡¨ã—ã¾ã™ã€‚

> [!NOTE]
> ```math
> \eta(Comm_t) = \frac{Comm_t}{100} \cdot 0.25
> ```

**0.25** ã¯ã€æ²»ç™‚çš„èª˜å°ã®å…¨ä½“çš„ãªæ„Ÿåº¦ã‚’æ±ºå®šã™ã‚‹åŸºæœ¬ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ä¿‚æ•°ï¼ˆ`config.json` ã® `learning_rate_scaling` ã§è¨­å®šå¯èƒ½ï¼‰ã§ã™ã€‚

*ã“ã®ã‚¹ãƒ†ãƒƒãƒ—å¹…ã¯ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ¬¡å…ƒã¨ã¨ã‚‚ã«ã€è¦ªå¯†åº¦ã¨æŸ”è»Ÿæ€§ã‚’ä¿ƒé€²ã™ã‚‹ãŸã‚ã® **é§†å‹•åŠ›** ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚*

å¾—ã‚‰ã‚ŒãŸãƒ™ã‚¯ãƒˆãƒ«ã«ã‚ˆã£ã¦ã€å€‹ã€…ã®å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ã«å¯¾ã™ã‚‹ **è¡Œå‹•èª˜å°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆBehavioral Steering Promptsï¼‰** ãŒèª¿æ•´ã•ã‚Œã€ã‚·ã‚¹ãƒ†ãƒ ã‚’ **ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸä¸­å¿ƒ (50, 50)** ã¸ã¨å¼•ãå¯„ã›ã¾ã™ã€‚

## ğŸ“š å‚è€ƒæ–‡çŒ®
- **Olson's Circumplex Model**: [Circumplex Model: An Update (Prepare/Enrich)](https://www.prepare-enrich.com/wp-content/uploads/2022/08/Circumplex-Model-An-Update.pdf)
- **FACES IV Manual**: [FACES IV: Manual de AplicaciÃ³n de Instrumento](https://www.studocu.com/cl/document/universidad-de-valparaiso/trabajo-social-de-familia/faces-iv-manual-aplicacion-de-instrumento/107365427)

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
